<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTC导航站</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/md5.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="shortcut icon" href="icons/H.ico" type="image/x-icon">
    <link rel="icon" href="icons/H.ico" type="image/x-icon">
   
</head>
<body>
    <button class="theme-switch-btn" title="切换暗色/亮色模式">
        <i class="fas fa-moon"></i>
        <i class="fas fa-sun"></i>
    </button>
    <button class="settings-btn" title="设置">
        <i class="fas fa-cog"></i>
    </button>
    <button class="bg-switch-btn" title="切换背景壁纸">
        <i class="fas fa-image"></i>
    </button>
    <button id="scrollTopBtn" class="scroll-top-btn">
        <i class="fas fa-arrow-up"></i>
    </button>

    <div class="container">
        <!-- 顶部导航 -->
        <header class="header">
            <h1 class="logo">HTC导航站</h1>
        </header>
       
        <!-- 搜索区域 -->
        <div class="search-section compact-search">
            <div class="search-engine-tabs">
                <button class="active">百度</button>
                <button>必应</button>
                <button>杨得</button>
            </div>
            <div class="search-container">
            <div class="search-box">
                    <input type="text" placeholder="输入关键词搜索...">
                    <button class="clear-search" title="清除搜索内容">
                        <i class="fas fa-times"></i>
                    </button>
                    <a class="translate-button" href="#" title="翻译此内容">
                        <img src="icons/translator.png" alt="翻译" style="height:60%">
                    </a>
                <button class="search-button">
                    <i class="fas fa-search"></i>
                </button>
                </div>
                <!-- 将下拉菜单移到这里 -->
                <div class="search-dropdown">
                    <div class="dropdown-content">
                        <div class="history-section">
                            <div class="section-title">
                                <i class="fas fa-history"></i>
                                <span>搜索历史</span>
                                <button class="clear-all-history" title="清空历史记录">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </div>
                            <ul class="history-list">
                                <!-- 历史记录将通过JavaScript动态添加 -->
                            </ul>
                        </div>
                        <div class="hot-section">
                            <div class="section-title">
                                <div class="title-left">
                                    <i class="fas fa-fire"></i>
                                    <span>热门搜索</span>
                                </div>
                                <button class="refresh-hot" title="刷新热搜">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <ul class="hot-list">
                                <!-- 热搜内容将通过JavaScript动态添加 -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 添加遮罩层和移动翻译卡片到这里 -->
        <div class="translate-overlay"></div>
        <div class="translate-card" style="display:none;">
            <div class="translate-title">
                <span>翻译卡片</span>
                <button class="close-translate-btn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="translate-header">
                <div class="language-selector">
                    <select class="source-lang">
                        <option value="auto">自动检测</option>
                        <option value="zh">中文</option>
                        <option value="wyw">文言文</option>
                        <option value="en">英文</option>
                        <option value="jp">日语</option>
                        <option value="kor">韩语</option>
                        <option value="fra">法语</option>
                        <option value="de">德语</option>
                        <option value="spa">西班牙语</option>
                        <option value="ru">俄语</option>
                        <option value="el">希腊语</option>
                    </select>
                    <span class="switch-lang">⇄</span>
                    <select class="target-lang">
                        <option value="zh">中文</option>
                        <option value="wyw">文言文</option>
                        <option value="jp">日语</option>
                        <option value="kor">韩语</option>
                        <option value="fra">法语</option>
                        <option value="de">德语</option>
                        <option value="spa">西班牙语</option>
                        <option value="ru">俄语</option>
                        <option value="el">希腊语</option>
                    </select>
                </div>
            </div>
            <div class="translate-body">
                <div class="source-text-container">
                <textarea class="source-text" placeholder="请输入要翻译的文本"></textarea>
                    <button class="clear-text-btn" style="display: none;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <button class="translate-start-btn">
                    <i class="fas fa-language"></i>
                    <span>开始翻译</span>
                    <i class="fas fa-spinner" style="display: none;"></i>
                </button>
                <div class="target-text-container">
                <textarea class="target-text" placeholder="翻译结果" readonly></textarea>
                    <button class="copy-text-btn" style="display: none;">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            </div>
        </div>

            <!-- 新增分类导航栏 -->
        <div class="category-nav-container">
            <nav class="category-nav">
                <ul>
                    <li class="active">视频资源</li>
                    <li>AI 工具</li>
                    <li>学习资源</li>
                    <li>社交媒体</li>
                </ul>
            </nav>
        </div>
    

           
           <div class="content-area">

                <!-- 其他分类通过JavaScript动态生成 -->

            <script>
                
                        // 新增搜索引擎配置
                        const searchEngines = {
                            "必应": {
                                url: "https://cn.bing.com/search",
                                param: "q"
                            },
                            "百度": {
                                url: "https://www.baidu.com/s",
                                param: "wd"
                            },
                            "杨得": {
                                url: "https://wap.yandex.com/search/",
                                param: "text"
                            }
                        };

                        // 搜索功能实现
                        function handleSearch() {
                        const input = document.querySelector('.search-box input');
                        const keyword = input.value.trim();
                        const engine = document.querySelector('.search-engine-tabs .active').textContent;
                        
                        if (keyword) {
                            // 创建一个临时表单
                            const form = document.createElement('form');
                            form.method = 'GET';
                            form.action = searchEngines[engine].url;
                            form.target = '_blank';
                            
                            // 创建搜索参数输入
                            const searchInput = document.createElement('input');
                            searchInput.type = 'hidden';
                            searchInput.name = searchEngines[engine].param;
                            searchInput.value = keyword;
                            
                            // 如果是杨得搜索，添加额外参数
                            if (engine === "杨得") {
                                const lrInput = document.createElement('input');
                                lrInput.type = 'hidden';
                                lrInput.name = 'lr';
                                lrInput.value = '10591';
                                form.appendChild(lrInput);
                            }
                            
                            // 添加到表单并提交
                            form.appendChild(searchInput);
                            document.body.appendChild(form);
                            form.submit();
                            document.body.removeChild(form);
                        }
                         }

                        // 绑定搜索事件（在DOM加载完成后添加）
                        document.addEventListener('DOMContentLoaded', () => {
                            // 搜索按钮点击事件
                            document.querySelector('.search-button').addEventListener('click', handleSearch);
                            
                            // 回车键事件
                            document.querySelector('.search-box input').addEventListener('keypress', (e) => {
                                if (e.key === 'Enter') handleSearch();
                            });

                            // 搜索下拉菜单相关
                            const searchInput = document.querySelector('.search-box input');
                            const searchDropdown = document.querySelector('.search-dropdown');
                            const historyList = document.querySelector('.history-list');
                            
                            // 监听滚动事件，关闭下拉菜单
                            window.addEventListener('scroll', () => {
                                // 检查是否为移动端
                                const isMobile = window.innerWidth <= 768;
                                if (!isMobile && searchDropdown.style.display === 'block') {
                                    searchDropdown.style.display = 'none';
                                    // 取消搜索框的选中状态
                                    searchInput.blur();
                                }
                            }, true); // 使用捕获阶段以确保优先处理

                            // 从localStorage加载历史记录
                            function loadHistory() {
                                const history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
                                historyList.innerHTML = history.map(item => `
                                    <li>
                                        <span class="history-text">${item}</span>
                                        <button class="delete-history" title="删除此记录">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </li>
                                `).join('');

                                // 添加删除按钮事件监听
                                document.querySelectorAll('.delete-history').forEach(btn => {
                                    btn.addEventListener('click', (e) => {
                                        e.stopPropagation(); // 阻止事件冒泡
                                        const item = e.target.closest('li');
                                        const text = item.querySelector('.history-text').textContent;
                                        deleteHistoryItem(text);
                                    });
                                });
                            }

                            // 删除单个历史记录
                            function deleteHistoryItem(keyword) {
                                let history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
                                history = history.filter(item => item !== keyword);
                                localStorage.setItem('searchHistory', JSON.stringify(history));
                                loadHistory();
                            }

                            // 清空所有历史记录
                            document.querySelector('.clear-all-history').addEventListener('click', () => {
                                localStorage.setItem('searchHistory', JSON.stringify([]));
                                loadHistory();
                            });

                            // 保存历史记录
                            function saveHistory(keyword) {
                                let history = JSON.parse(localStorage.getItem('searchHistory') || '[]');
                                // 移除已存在的相同关键词
                                history = history.filter(item => item !== keyword);
                                // 添加到开头
                                history.unshift(keyword);
                                // 只保留前10条
                                history = history.slice(0, 10);
                                localStorage.setItem('searchHistory', JSON.stringify(history));
                                loadHistory();
                            }

                            // 搜索框获得焦点时显示下拉菜单
                            searchInput.addEventListener('focus', () => {
                                searchDropdown.style.display = 'block';
                                loadHistory();
                                loadHotSearches(); // 这里不强制刷新
                            });

                            // 清除搜索按钮点击事件
                            const clearSearchBtn = document.querySelector('.clear-search');
                            clearSearchBtn.addEventListener('click', (e) => {
                                e.stopPropagation(); // 阻止事件冒泡
                                searchInput.value = '';
                                searchInput.focus(); // 保持焦点
                                searchDropdown.style.display = 'block'; // 保持下拉菜单显示
                            });

                            // 热搜相关功能
                            const REFRESH_INTERVAL = 30 * 60 * 1000; // 30分钟
                            const UPDATE_INTERVAL = 5 * 60 * 60 * 1000; // 5小时

                            // 获取热搜数据
                            async function loadHotSearches(forceUpdate = false) {
                                const hotList = document.querySelector('.hot-list');
                                const refreshBtn = document.querySelector('.refresh-hot');
                                
                                try {
                                    // 检查是否需要更新
                                    const lastUpdate = localStorage.getItem('lastHotSearchUpdate');
                                    const lastRefresh = localStorage.getItem('lastHotSearchRefresh');
                                    const now = Date.now();

                                    if (!forceUpdate && lastUpdate && (now - parseInt(lastUpdate) < UPDATE_INTERVAL)) {
                                        // 从缓存加载数据
                                        const cachedData = localStorage.getItem('hotSearchesCache');
                                        if (cachedData) {
                                            hotList.innerHTML = cachedData;
                                            return;
                                        }
                                    }

                                    // 检查刷新按钮冷却时间
                                    if (forceUpdate && lastRefresh && (now - parseInt(lastRefresh) < REFRESH_INTERVAL)) {
                                        const waitTime = Math.ceil((REFRESH_INTERVAL - (now - parseInt(lastRefresh))) / 60000);
                                        alert(`请等待 ${waitTime} 分钟后再刷新`);
                                        return;
                                    }

                                    // 显示加载状态
                                    refreshBtn.classList.add('loading');
                                    
                                    const response = await fetch('/.netlify/functions/search');
                                    const data = await response.json();
                                    
                                    if (data.code === 200 && data.data) {
                                        // 只显示前10条热搜
                                        const hotSearches = data.data.slice(0, 10).map(item => `
                                            <li>
                                                <span class="hot-index">${item.index}</span>
                                                <span class="hot-title">${item.title}</span>
                                                <span class="hot-count">${item.hot}</span>
                                            </li>
                                        `).join('');
                                        
                                        hotList.innerHTML = hotSearches;
                                        
                                        // 更新缓存和时间戳
                                        localStorage.setItem('hotSearchesCache', hotSearches);
                                        localStorage.setItem('lastHotSearchUpdate', now.toString());
                                        if (forceUpdate) {
                                            localStorage.setItem('lastHotSearchRefresh', now.toString());
                                        }
                                    }
                                } catch (error) {
                                    console.error('获取热搜失败:', error);
                                    hotList.innerHTML = '<li>获取热搜失败</li>';
                                } finally {
                                    refreshBtn.classList.remove('loading');
                                }
                            }

                            // 绑定刷新按钮事件
                            document.querySelector('.refresh-hot').addEventListener('click', () => {
                                loadHotSearches(true);
                            });

                            // 页面加载时获取一次热搜
                            loadHotSearches();

                            // 点击其他地方时隐藏下拉菜单
                            document.addEventListener('click', (e) => {
                                if (!searchInput.contains(e.target) && !searchDropdown.contains(e.target)) {
                                    searchDropdown.style.display = 'none';
                                }
                            });

                            // 点击历史记录或热门搜索项
                            searchDropdown.addEventListener('click', (e) => {
                                const target = e.target.closest('li');
                                if (target) {
                                    // 如果点击的是热搜项，只获取标题部分
                                    const hotTitle = target.querySelector('.hot-title');
                                    if (hotTitle) {
                                        searchInput.value = hotTitle.textContent.trim();
                                    } else {
                                        // 如果是历史记录，获取文本内容并清理空格
                                        const historyText = target.querySelector('.history-text');
                                        searchInput.value = historyText ? historyText.textContent.trim() : target.textContent.trim();
                                    }
                                    searchDropdown.style.display = 'none';
                                    handleSearch();
                                }
                            });

                            // 修改搜索处理函数，添加历史记录
                            const originalHandleSearch = handleSearch;
                            handleSearch = function() {
                                const keyword = searchInput.value.trim();
                                if (keyword) {
                                    saveHistory(keyword);
                                    originalHandleSearch();
                                }
                            };

                            // 初始加载历史记录
                            loadHistory();

                            // 翻译按钮点击事件
                            const translateButton = document.querySelector('.translate-button');
                            const translateCard = document.querySelector('.translate-card');
                            const translateOverlay = document.querySelector('.translate-overlay');
                            const switchLangButton = document.querySelector('.switch-lang');
                            
                            translateButton.addEventListener('click', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                if(translateCard.style.display === 'none' || !translateCard.style.display) {
                                    translateCard.style.display = 'block';
                                    translateOverlay.classList.add('show');
                                    document.body.style.overflow = 'hidden'; // 防止背景滚动
                                    
                                    // 获取搜索框的文本并填充到翻译输入框
                                    const searchText = searchInput.value.trim();
                                    if (searchText) {
                                        sourceText.value = searchText;
                                        // 自动触发一次翻译
                                        translateStartBtn.click();
                                    }
                                } else {
                                    translateCard.style.display = 'none';
                                    translateOverlay.classList.remove('show');
                                    document.body.style.overflow = '';
                                }
                            });

                            // 点击遮罩层关闭翻译卡片
                            translateOverlay.addEventListener('click', function() {
                                translateCard.style.display = 'none';
                                translateOverlay.classList.remove('show');
                                document.body.style.overflow = '';
                            });

                            // 阻止翻译卡片内部点击事件冒泡
                            translateCard.addEventListener('click', function(e) {
                                e.stopPropagation();
                            });

                            // 添加关闭按钮点击事件
                            const closeTranslateBtn = document.querySelector('.close-translate-btn');
                            closeTranslateBtn.addEventListener('click', function() {
                                translateCard.style.display = 'none';
                                translateOverlay.classList.remove('show');
                                document.body.style.overflow = '';
                            });

                            // 语言切换按钮功能
                            switchLangButton.addEventListener('click', function() {
                                const sourceLang = document.querySelector('.source-lang');
                                const targetLang = document.querySelector('.target-lang');
                                const targetText = document.querySelector('.target-text');
                                
                                // 交换语言选择
                                const tempLang = sourceLang.value;
                                sourceLang.value = targetLang.value;
                                targetLang.value = tempLang;
                                
                                // 交换文本内容
                                const tempText = sourceText.value;
                                sourceText.value = targetText.value;
                                targetText.value = tempText;

                                // 更新复制按钮显示状态
                                copyTextBtn.style.display = targetText.value ? 'block' : 'none';
                            });

                            // 监听源文本变化,自动翻译
                            let translateTimeout;
                            const translateStartBtn = document.querySelector('.translate-start-btn');
                            const sourceText = document.querySelector('.source-text');
                            const targetText = document.querySelector('.target-text');
                            const clearTextBtn = document.querySelector('.clear-text-btn');
                            const copyTextBtn = document.querySelector('.copy-text-btn');
                            
                            // 监听源文本变化，显示/隐藏清空按钮
                            sourceText.addEventListener('input', function() {
                                clearTimeout(translateTimeout);
                                clearTextBtn.style.display = this.value ? 'block' : 'none';
                                // 清空源文本时也隐藏复制按钮
                                if (!this.value) {
                                    copyTextBtn.style.display = 'none';
                                }
                            });

                            // 清空按钮点击事件
                            clearTextBtn.addEventListener('click', function() {
                                sourceText.value = '';
                                targetText.value = '';
                                this.style.display = 'none';
                                copyTextBtn.style.display = 'none';
                            });

                            // 复制按钮点击事件
                            copyTextBtn.addEventListener('click', async function() {
                                try {
                                    await navigator.clipboard.writeText(targetText.value);
                                    this.classList.add('copied');
                                    setTimeout(() => {
                                        this.classList.remove('copied');
                                    }, 1000);
                                } catch (err) {
                                    console.error('复制失败:', err);
                                }
                            });

                            // 添加翻译按钮点击事件
                            translateStartBtn.addEventListener('click', async function() {
                                const text = sourceText.value;
                                if (!text) return;

                                // 显示加载状态
                                this.classList.add('loading');
                                const targetTextArea = document.querySelector('.target-text');
                                
                                try {
                                    const sourceLang = document.querySelector('.source-lang').value;
                                    const targetLang = document.querySelector('.target-lang').value;
                                    
                                    const response = await fetch('/.netlify/functions/translate', {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({
                                            text: text,
                                            from: sourceLang,
                                            to: targetLang
                                        })
                                    });
                                    
                                    const data = await response.json();
                                    
                                    if (!response.ok) {
                                        throw new Error(data.error || data.details || '翻译请求失败');
                                    }
                                    
                                    if (data.error) {
                                        throw new Error(data.error);
                                    }
                                    
                                    targetTextArea.value = data.translatedText;
                                    // 显示复制按钮
                                    copyTextBtn.style.display = 'block';
                                } catch (error) {
                                    console.error('翻译错误:', error);
                                    targetTextArea.value = `翻译失败: ${error.message}`;
                                    // 错误时也显示复制按钮
                                    copyTextBtn.style.display = 'block';
                                } finally {
                                    // 移除加载状态
                                    this.classList.remove('loading');
                                }
                            });
                        });

                        // 滚动到顶部功能
                        document.addEventListener('DOMContentLoaded', () => {
                            const scrollBtn = document.getElementById('scrollTopBtn');
                            
                            // 显示/隐藏按钮
                            window.addEventListener('scroll', () => {
                                if (window.scrollY > 200) {
                                    scrollBtn.classList.add('show');
                                } else {
                                    scrollBtn.classList.remove('show');
                                }
                            });

                            // 点击事件
                            scrollBtn.addEventListener('click', () => {
                                window.scrollTo({
                                    top: 0,
                                    behavior: 'smooth'
                                });
                            });
                        });
 
                // 分类数据（添加标题字段）
                        async function loadCategories() {
                            try {
                                console.log('开始加载分类数据...');
                                const response = await fetch('./categories.json');
                                if (!response.ok) {
                                    throw new Error(`HTTP error! status: ${response.status}`);
                                }
                                const categories = await response.json();
                                console.log('分类数据加载成功:', categories);
                                return categories;
                            } catch (error) {
                                console.error('加载分类数据失败:', error);
                                return {};
                            }
                        }
                                       
                        function generateCard(item) {
                            const card = document.createElement('a');
                            card.className = 'website-card';
                            card.href = item.url;
                            card.target = '_blank';
                            
                            const cardHeader = document.createElement('div');
                            cardHeader.className = 'card-header';
                            
                            if (item.icon) {
                                const favicon = document.createElement('img');
                                favicon.className = 'favicon';
                                favicon.src = item.icon;
                                favicon.alt = `${item.name}图标`;
                                favicon.onerror = function() {
                                    this.style.display = 'none';
                                    this.nextElementSibling.style.display = 'inline-block';
                                };
                                cardHeader.appendChild(favicon);
                            }
                            
                            const linkIcon = document.createElement('i');
                            linkIcon.className = 'fas fa-link link-icon';
                            linkIcon.style.display = item.icon ? 'none' : 'inline-block';
                            cardHeader.appendChild(linkIcon);
                            
                            const title = document.createElement('h3');
                            title.textContent = item.name;
                            cardHeader.appendChild(title);
                            
                            const link = document.createElement('div');
                            link.className = 'website-link';
                            link.textContent = item.text || item.url;
                            
                            card.appendChild(cardHeader);
                            card.appendChild(link);
                            
                            return card;
                        }

                        // 初始化函数
                        async function initCategories() {
                            try {
                                console.log('开始初始化分类...');
                            const container = document.querySelector('.content-area');
                                if (!container) {
                                    throw new Error('找不到 content-area 容器');
                                }
                            container.innerHTML = '';

                                const categories = await loadCategories();
                                if (Object.keys(categories).length === 0) {
                                    throw new Error('没有找到分类数据');
                                }

                            Object.entries(categories).forEach(([category, data]) => {
                                    console.log(`正在创建分类: ${category}`);
                                const categoryDiv = document.createElement('div');
                                categoryDiv.className = 'category-content';
                                categoryDiv.dataset.category = category;

                                const title = document.createElement('h2');
                                title.textContent = data.title;
                                
                                const cardGrid = document.createElement('div');
                                cardGrid.className = 'card-grid';
                                
                                data.items.forEach(item => {
                                    cardGrid.appendChild(generateCard(item));
                                });

                                categoryDiv.append(title, cardGrid);
                                container.appendChild(categoryDiv);
                            });

                                const firstCategory = document.querySelector('.category-content');
                                if (firstCategory) {
                                    firstCategory.classList.add('active');
                                    console.log('分类初始化完成');
                                } else {
                                    throw new Error('未能创建任何分类内容');
                                }
                            } catch (error) {
                                console.error('初始化分类失败:', error);
                                const container = document.querySelector('.content-area');
                                if (container) {
                                    container.innerHTML = `<div class="error-message">加载分类失败: ${error.message}</div>`;
                                }
                            }
                        }

                        // 分类导航交互
                        function bindCategoryEvents() {
                            document.querySelectorAll('.category-nav li').forEach(li => {
                                li.addEventListener('click', () => {
                                    // 移除所有active类
                                    document.querySelectorAll('.category-nav li, .category-content').forEach(el => {
                                        el.classList.remove('active');
                                    });
                                    
                                    // 添加active类到当前点击项
                                    li.classList.add('active');
                                    const targetCategory = li.textContent.trim();
                                    const targetContent = document.querySelector(`[data-category="${targetCategory}"]`);
                                    targetContent.classList.add('active');

                                    // 获取导航栏高度
                                    const navHeight = document.querySelector('.category-nav-container').offsetHeight;
                                    
                                    // 计算目标元素的位置
                                    const targetPosition = targetContent.getBoundingClientRect().top + window.pageYOffset - navHeight;

                                    // 平滑滚动到目标位置
                                    window.scrollTo({
                                        top: targetPosition,
                                        behavior: 'smooth'
                                    });
                                });
                            });
                        }

                        // 确保在 DOM 加载完成后初始化分类
                        document.addEventListener('DOMContentLoaded', () => {
                            console.log('DOM加载完成，开始初始化...');
                            initCategories().then(() => {
                            bindCategoryEvents();
                                console.log('分类和事件绑定完成');
                            }).catch(error => {
                                console.error('初始化过程出错:', error);
                            });
                        });

                    // 搜索引擎切换
                    document.querySelectorAll('.search-engine-tabs button').forEach(btn => {
                        btn.addEventListener('click', () => {
                            document.querySelector('.search-engine-tabs .active').classList.remove('active');
                            btn.classList.add('active');
                        });
                    });

                        // 背景图片列表
                        const backgrounds = [
                            'images/HTC1.png',  // 默认背景
                            'images/HTC2.jpg',
                            'images/HTC3.png',
                        ];

                        // 获取当前背景索引
                        let currentBgIndex = parseInt(localStorage.getItem('currentBgIndex') || '0');

                        // 页面加载时设置保存的背景
                        document.addEventListener('DOMContentLoaded', () => {
                            document.body.style.backgroundImage = `url('${backgrounds[currentBgIndex]}')`;
                        });

                        // 暗色模式切换功能
                        document.addEventListener('DOMContentLoaded', () => {
                            const themeBtn = document.querySelector('.theme-switch-btn');
                            const moonIcon = themeBtn.querySelector('.fa-moon');
                            const sunIcon = themeBtn.querySelector('.fa-sun');
                            
                            // 从 localStorage 获取主题设置
                            const isDarkMode = localStorage.getItem('darkMode') === 'true';
                            if (isDarkMode) {
                                document.body.classList.add('dark-mode');
                                moonIcon.style.opacity = '0';
                                sunIcon.style.opacity = '1';
                            } else {
                                moonIcon.style.opacity = '1';
                                sunIcon.style.opacity = '0';
                            }
                            
                            // 切换主题
                            themeBtn.addEventListener('click', () => {
                                document.body.classList.toggle('dark-mode');
                                const isDark = document.body.classList.contains('dark-mode');
                                
                                // 切换图标显示
                                if (isDark) {
                                    moonIcon.style.opacity = '0';
                                    sunIcon.style.opacity = '1';
                                } else {
                                    moonIcon.style.opacity = '1';
                                    sunIcon.style.opacity = '0';
                                }
                                
                                // 保存设置
                                localStorage.setItem('darkMode', isDark);
                            });
                        });

                        // 自定义壁纸功能
                        let customWallpapers = [];
                        let currentCustomWallpaperIndex = 0;

                        // 选择文件夹
                        async function selectWallpaperFolder() {
                            try {
                                const input = document.createElement('input');
                                input.type = 'file';
                                input.multiple = true;
                                input.accept = 'image/*,video/mp4'; // 添加MP4格式支持
                                
                                input.onchange = async (e) => {
                                    const files = Array.from(e.target.files);
                                    if (files.length > 0) {
                                        customWallpapers = files.map(file => {
                                            if (file.type.startsWith('video/')) {
                                                // 如果是视频文件，创建视频元素
                                                const video = document.createElement('video');
                                                video.src = URL.createObjectURL(file);
                                                video.loop = true;
                                                video.muted = true;
                                                video.playsInline = true;
                                                return video;
                                            } else {
                                                // 如果是图片文件，创建URL
                                                return URL.createObjectURL(file);
                                            }
                                        });
                                        currentCustomWallpaperIndex = 0;
                                        
                                        // 保存设置
                                        const settings = JSON.parse(localStorage.getItem('settings') || '{}');
                                        settings.useCustomWallpaper = true;
                                        localStorage.setItem('settings', JSON.stringify(settings));
                                        
                                        // 更新输入框显示
                                        document.getElementById('wallpaperPath').value = `${files.length} 个文件已选择`;
                                        
                                        // 应用第一个壁纸
                                        applyWallpaper(customWallpapers[0]);
                                    }
                                };
                                
                                input.click();
                            } catch (error) {
                                console.error('选择文件失败:', error);
                                alert('选择文件失败: ' + error.message);
                            }
                        }

                        // 添加应用壁纸的函数
                        function applyWallpaper(wallpaper) {
                            const body = document.body;
                            
                            // 清除之前的背景
                            body.style.backgroundImage = '';
                            body.style.background = '';
                            
                            // 移除之前的视频元素（如果存在）
                            const existingVideo = body.querySelector('video');
                            if (existingVideo) {
                                existingVideo.remove();
                            }
                            
                            if (wallpaper instanceof HTMLVideoElement) {
                                // 如果是视频
                                wallpaper.style.position = 'fixed';
                                wallpaper.style.top = '0';
                                wallpaper.style.left = '0';
                                wallpaper.style.width = '100%';
                                wallpaper.style.height = '100%';
                                wallpaper.style.objectFit = 'cover';
                                wallpaper.style.zIndex = '-1';
                                body.appendChild(wallpaper);
                                wallpaper.play().catch(error => console.error('视频播放失败:', error));
                            } else {
                                // 如果是图片
                                body.style.backgroundImage = `url('${wallpaper}')`;
                            }
                        }

                        // 修改背景切换按钮点击事件
                        document.querySelector('.bg-switch-btn').addEventListener('click', () => {
                            const settings = JSON.parse(localStorage.getItem('settings') || '{}');
                            
                            if (settings.useCustomWallpaper && customWallpapers.length > 0) {
                                // 使用自定义背景
                                currentCustomWallpaperIndex = (currentCustomWallpaperIndex + 1) % customWallpapers.length;
                                applyWallpaper(customWallpapers[currentCustomWallpaperIndex]);
                            } else {
                                // 使用默认背景
                                currentBgIndex = (currentBgIndex + 1) % backgrounds.length;
                                document.body.style.backgroundImage = `url('${backgrounds[currentBgIndex]}')`;
                                localStorage.setItem('currentBgIndex', currentBgIndex.toString());
                            }
                        });

                        // 修改设置面板相关代码
                        document.addEventListener('DOMContentLoaded', () => {
                            const settingsBtn = document.querySelector('.settings-btn');
                            const settingsOverlay = document.querySelector('.settings-overlay');
                            const settingsPanel = document.querySelector('.settings-panel');
                            const closeSettingsBtn = document.querySelector('.close-settings-btn');
                            const useDefaultWallpaper = document.getElementById('useDefaultWallpaper');
                            const wallpaperPathContainer = document.querySelector('.wallpaper-path-container');
                            const wallpaperPathInput = document.getElementById('wallpaperPath');
                            const selectPathBtn = document.querySelector('.select-path-btn');

                            // 打开设置面板
                            settingsBtn.addEventListener('click', () => {
                                settingsOverlay.style.display = 'block';
                                settingsPanel.classList.add('show');
                                document.body.style.overflow = 'hidden';
                            });

                            // 关闭设置面板
                            function closeSettings() {
                                settingsPanel.classList.remove('show');
                                settingsOverlay.style.display = 'none';
                                document.body.style.overflow = '';
                            }

                            closeSettingsBtn.addEventListener('click', closeSettings);
                            settingsOverlay.addEventListener('click', closeSettings);

                            // 加载设置
                            function loadSettings() {
                                // 加载壁纸设置
                                const useCustomWallpaper = localStorage.getItem('useCustomWallpaper') === 'true';
                                const wallpaperPath = localStorage.getItem('wallpaperPath');
                                const customWallpapers = JSON.parse(localStorage.getItem('customWallpapers') || '[]');
                                
                                // 更新壁纸设置UI
                                document.getElementById('useCustomWallpaper').checked = useCustomWallpaper;
                                document.getElementById('wallpaperPath').value = wallpaperPath || '';
                                document.getElementById('wallpaperPathContainer').style.display = useCustomWallpaper ? 'block' : 'none';
                                
                                // 应用壁纸
                                if (useCustomWallpaper && customWallpapers.length > 0) {
                                    applyWallpaper(customWallpapers[0]);
                                } else {
                                    // 使用默认壁纸
                                    const defaultWallpapers = [
                                        'images/HTC1.png',
                                        'images/HTC2.jpg',
                                        'images/HTC3.png'
                                    ];
                                    const currentIndex = parseInt(localStorage.getItem('currentBackgroundIndex') || '0');
                                    document.body.style.backgroundImage = `url('${defaultWallpapers[currentIndex]}')`;
                                    // 移除可能存在的视频元素
                                    const existingVideo = document.body.querySelector('video');
                                    if (existingVideo) {
                                        existingVideo.remove();
                                    }
                                }
                                
                                // 加载分类显示设置
                                const showAllCategories = localStorage.getItem('showAllCategories') !== 'false';
                                document.getElementById('showAllCategories').checked = showAllCategories;
                                updateCategoriesVisibility(showAllCategories);
                                
                                // 加载暗色模式设置
                                const isDarkMode = localStorage.getItem('darkMode') === 'true';
                                document.body.classList.toggle('dark-mode', isDarkMode);
                            }

                            // 保存设置
                            function saveSettings() {
                                // 保存壁纸设置
                                const useCustomWallpaper = document.getElementById('useCustomWallpaper').checked;
                                const wallpaperPath = document.getElementById('wallpaperPath').value;
                                
                                localStorage.setItem('useCustomWallpaper', useCustomWallpaper);
                                localStorage.setItem('wallpaperPath', wallpaperPath);
                                
                                // 如果使用自定义壁纸，保存壁纸路径
                                if (useCustomWallpaper && wallpaperPath) {
                                    const customWallpapers = [wallpaperPath];
                                    localStorage.setItem('customWallpapers', JSON.stringify(customWallpapers));
                                }
                                
                                // 保存分类显示设置
                                const showAllCategories = document.getElementById('showAllCategories').checked;
                                localStorage.setItem('showAllCategories', showAllCategories);
                                
                                // 保存暗色模式设置
                                const isDarkMode = document.body.classList.contains('dark-mode');
                                localStorage.setItem('darkMode', isDarkMode);
                            }

                            // 更新分类显示状态
                            function updateCategoriesVisibility(show) {
                                const categories = document.querySelectorAll('.category-content');
                                categories.forEach(category => {
                                    category.style.display = show ? 'block' : 'none';
                                });
                            }

                            // 监听设置变化
                            useDefaultWallpaper.addEventListener('change', () => {
                                wallpaperPathContainer.style.display = useDefaultWallpaper.checked ? 'none' : 'block';
                                saveSettings();
                                
                                // 切换回默认背景
                                if (useDefaultWallpaper.checked) {
                                    document.body.style.backgroundImage = `url('${backgrounds[currentBgIndex]}')`;
                                    // 移除可能存在的视频元素
                                    const existingVideo = document.body.querySelector('video');
                                    if (existingVideo) {
                                        existingVideo.remove();
                                    }
                                }
                            });

                            // 监听分类显示设置变化
                            document.getElementById('showAllCategories').addEventListener('change', (e) => {
                                updateCategoriesVisibility(e.target.checked);
                                saveSettings();
                            });

                            // 选择文件夹
                            selectPathBtn.addEventListener('click', selectWallpaperFolder);

                            // 页面加载时加载设置
                            loadSettings();
                        });
            </script>
                </div>
            </div>
        </div>
    </div>

    <!-- 在body末尾添加设置面板 -->
    <div class="settings-overlay"></div>
    <div class="settings-panel">
        <div class="settings-header">
            <h2>设置</h2>
            <button class="close-settings-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="settings-content">
            <div class="setting-item">
                <label class="setting-label">使用网站壁纸</label>
                <label class="switch">
                    <input type="checkbox" id="useDefaultWallpaper" checked>
                    <span class="slider round"></span>
                </label>
            </div>
            <div class="setting-item">
                <label class="setting-label">显示所有分类</label>
                <label class="switch">
                    <input type="checkbox" id="showAllCategories" checked>
                    <span class="slider round"></span>
                </label>
            </div>
            <div class="setting-item wallpaper-path-container" style="display: none;">
                <label class="setting-label">自定义壁纸路径</label>
                <div class="path-input-container">
                    <input type="text" id="wallpaperPath" readonly placeholder="请选择壁纸文件夹路径">
                    <button class="select-path-btn">选择路径</button>
                </div>
                <p class="path-hint">支持的格式：PNG、JPG、MP4</p>
            </div>
        </div>
    </div>
</body>
</html>